import{br as J,bx as L,bu as k,bs as O,bn as Q}from"./index-b50be390.js";import{t as W}from"./common-a073e65d.js";import{A as Y,n as S,W as V,k as Z,o as v,B as b,Q as t,J as a,O as _,P as p,F as y,a2 as A,u as D,D as C,r as c,_ as G}from"./_plugin-vue_export-helper-60a1b51b.js";const H={class:"show-time"};var E=(r=>(r.normal="正常出勤",r.absent="旷工",r.miss="漏打卡",r.late="迟到",r.early="早退",r.lateAndEarly="迟到并早退",r))(E||{});const X=Y({__name:"Sign",setup(r){const w=O(),T=J(),f=L(),{infos:B}=k(T),{infos:g}=k(f),m=S(new Date),h=m.value.getFullYear(),u=S(m.value.getMonth()+1),s=V({normal:0,absent:0,miss:0,late:0,early:0,lateAndEarly:0}),i=V({type:"success",text:"正常"});Z(o=>{const l=g.value.detail[W(u.value)];for(const e in l)switch(l[e]){case"正常出勤":s.normal++;break;case"旷工":s.absent++;break;case"漏打卡":s.miss++;break;case"迟到":s.late++;break;case"早退":s.early++;break;case"迟到并早退":s.lateAndEarly++;break}for(const e in s)e!=="normal"&&s[e]!==0&&(i.type="danger",i.text="异常");o(()=>{i.type="success",i.text="正常";for(const e in s)s[e]=0})});const I=()=>{m.value=new Date(`${h}.${u.value}`)},F=()=>{w.push({path:"/exception",query:{month:u.value}})},M=o=>o.split("-")[2],N=o=>{const[,l,e]=o.split("-"),d=g.value.time[l][e];if(Array.isArray(d))return d.join("-")},U=()=>{f.putTimeAction({userid:B.value._id}).then(o=>{o.data.errcode===0&&(f.updateInfos(o.data.infos),Q.success("签到成功"))})};return(o,l)=>{const e=c("el-descriptions-item"),d=c("el-button"),z=c("el-tag"),P=c("el-descriptions"),R=c("el-option"),$=c("el-select"),j=c("el-space"),q=c("el-calendar");return v(),b(y,null,[t(P,{border:"",direction:"vertical",column:9},{default:a(()=>[t(e,{label:"月份"},{default:a(()=>[_(p(u.value)+"月",1)]),_:1}),(v(),b(y,null,A(E,(n,x)=>t(e,{key:x,label:n},{default:a(()=>[_(p(s[x]),1)]),_:2},1032,["label"])),64)),t(e,{label:"操作"},{default:a(()=>[t(d,{type:"primary",plain:"",size:"small",onClick:F},{default:a(()=>[_("查看详情")]),_:1})]),_:1}),t(e,{label:"考勤状态"},{default:a(()=>[t(z,{type:i.type,size:"small"},{default:a(()=>[_(p(i.text),1)]),_:1},8,["type"])]),_:1})]),_:1}),t(q,{modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=n=>m.value=n)},{header:a(()=>[t(d,{type:"primary",onClick:U},{default:a(()=>[_("在线签到")]),_:1}),t(j,null,{default:a(()=>[t(d,{plain:""},{default:a(()=>[_(p(D(h))+"年",1)]),_:1}),t($,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=n=>u.value=n),onChange:I},{default:a(()=>[(v(),b(y,null,A(12,n=>t(R,{key:n,value:n,label:n+"月"},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1})]),"date-cell":a(({data:n})=>[C("div",null,p(M(n.day)),1),C("div",H,p(N(n.day)),1)]),_:1},8,["modelValue"])],64)}}});const ae=G(X,[["__scopeId","data-v-df86169f"]]);export{ae as default};
